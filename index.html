<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Couple Photobooth üíï</title>

<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  padding:20px;
  text-align:center;
  font-family:Arial,sans-serif;
  background-color:#ffc1d9;
  background-image:
    linear-gradient(#ffffff55 2px, transparent 2px),
    linear-gradient(90deg, #ffffff55 2px, transparent 2px);
  background-size:40px 40px;
}

h2{
  font-family:'Pacifico',cursive;
  color:white;
}

.booth{
  background:white;
  max-width:340px;
  margin:auto;
  padding:15px;
  border-radius:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}

video{
  width:100%;
  aspect-ratio:3/4;
  object-fit:cover;
  border-radius:20px;
  background:black;
}

input{
  width:90%;
  padding:8px;
  margin:10px 0;
  border-radius:20px;
  border:1px solid #ccc;
  text-align:center;
}

button{
  padding:10px 18px;
  border:none;
  border-radius:25px;
  background:#ff5fa2;
  color:white;
  cursor:pointer;
  margin:5px;
}

#download{display:none}
canvas{display:none}
</style>
</head>

<body>

<h2>Couple Photobooth üíï</h2>

<div class="booth">
  <video id="video" autoplay playsinline></video>
  <input id="nameInput" placeholder="Nama Couple üíë">

  <button id="switchCam">üîÑ Ganti Kamera</button><br>
  <button id="capture">üì∏ Ambil Foto</button>
  <button id="download">‚¨áÔ∏è Download Strip</button>

  <canvas id="canvas"></canvas>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const captureBtn = document.getElementById("capture");
const downloadBtn = document.getElementById("download");
const switchCamBtn = document.getElementById("switchCam");
const nameInput = document.getElementById("nameInput");

let photos = [];
let currentFacing = "environment";
let stream = null;

/* ===== AKTIFKAN KAMERA ===== */
async function startCamera(){
  if(stream){
    stream.getTracks().forEach(t=>t.stop());
  }

  stream = await navigator.mediaDevices.getUserMedia({
    video:{ facingMode:{ ideal: currentFacing }},
    audio:false
  });

  video.srcObject = stream;
}

startCamera();

/* ===== GANTI KAMERA ===== */
switchCamBtn.onclick = ()=>{
  currentFacing = currentFacing === "user" ? "environment" : "user";
  startCamera();
};

/* ===== AMBIL FOTO ===== */
captureBtn.onclick = ()=>{
  if(photos.length >= 3) return;

  const temp = document.createElement("canvas");
  temp.width = video.videoWidth;
  temp.height = video.videoHeight;
  temp.getContext("2d").drawImage(video,0,0);
  photos.push(temp);

  if(photos.length === 3){
    createStrip();
    downloadBtn.style.display = "inline-block";
  }
};

/* ===== BACKGROUND GRID ===== */
function drawGrid(){
  ctx.fillStyle="#ffc1d9";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="rgba(255,255,255,0.35)";
  ctx.lineWidth=2;

  for(let x=0;x<canvas.width;x+=40){
    ctx.beginPath();
    ctx.moveTo(x,0);
    ctx.lineTo(x,canvas.height);
    ctx.stroke();
  }
  for(let y=0;y<canvas.height;y+=40){
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(canvas.width,y);
    ctx.stroke();
  }
}

/* ===== FOTO PROPORSIONAL ===== */
function drawPhotoCover(img,x,y,w,h){
  const ir = img.width/img.height;
  const fr = w/h;
  let sx,sy,sw,sh;

  if(ir > fr){
    sh = img.height;
    sw = sh * fr;
    sx = (img.width - sw)/2;
    sy = 0;
  }else{
    sw = img.width;
    sh = sw / fr;
    sx = 0;
    sy = (img.height - sh)/2;
  }

  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
}

/* ===== DEKORASI ===== */
function drawStar(x,y,r){
  ctx.save();
  ctx.translate(x,y);
  ctx.beginPath();
  ctx.moveTo(0,-r);
  for(let i=0;i<5;i++){
    ctx.rotate(Math.PI/5);
    ctx.lineTo(0,-r*0.5);
    ctx.rotate(Math.PI/5);
    ctx.lineTo(0,-r);
  }
  ctx.closePath();
  ctx.fillStyle="white";
  ctx.fill();
  ctx.restore();
}

function drawPaperPlane(x,y,s){
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.moveTo(x,y);
  ctx.lineTo(x+s,y+s/2);
  ctx.lineTo(x,y+s);
  ctx.lineTo(x+s*0.2,y+s/2);
  ctx.closePath();
  ctx.fill();
}

/* ===== STRIP ===== */
function createStrip(){
  const stripW=900, photoW=520, photoH=700, gap=40;
  canvas.width=stripW;
  canvas.height=160+(photoH+gap)*3+260;

  drawGrid();

  ctx.font="60px Pacifico";
  ctx.fillStyle="#ff3d8b";
  ctx.textAlign="center";
  ctx.fillText("Couple üíï", stripW/2, 95);

  let y=140;
  photos.forEach(p=>{
    const x=(stripW-photoW)/2;
    ctx.fillStyle="white";
    ctx.fillRect(x-15,y-15,photoW+30,photoH+30);
    drawPhotoCover(p,x,y,photoW,photoH);

    drawStar(x-40,y+120,10);
    drawStar(x+photoW+40,y+200,8);
    drawPaperPlane(x-70,y+photoH-120,32);
    drawPaperPlane(x+photoW+40,y+50,32);

    y+=photoH+gap;
  });

  /* ===== NAMA & TANGGAL DIPERBESAR ===== */
  ctx.font="52px Pacifico";
  ctx.fillStyle="#ff3d8b";
  ctx.fillText(nameInput.value||"Couple üíë", stripW/2, canvas.height-120);

  ctx.font="32px Arial";
  ctx.fillText(new Date().toLocaleDateString("id-ID"), stripW/2, canvas.height-70);
}

/* ===== DOWNLOAD ===== */
downloadBtn.onclick=()=>{
  const a=document.createElement("a");
  a.download="photobooth-couple.png";
  a.href=canvas.toDataURL("image/png");
  a.click();
};
</script>

</body>
</html>

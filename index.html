<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Couple Photobooth üíï</title>

<link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">

<style>
body{
  margin:0;
  padding:20px;
  text-align:center;
  font-family:Arial,sans-serif;

  background-color:#ffc1d9;
  background-image:
    linear-gradient(#ffffff55 2px, transparent 2px),
    linear-gradient(90deg, #ffffff55 2px, transparent 2px);
  background-size:40px 40px;
}

h2{
  font-family:'Pacifico',cursive;
  color:white;
}

.booth{
  background:white;
  max-width:340px;
  margin:auto;
  padding:15px;
  border-radius:25px;
  box-shadow:0 10px 25px rgba(0,0,0,.25);
}

video{
  width:100%;
  aspect-ratio:3/4;
  object-fit:cover;
  border-radius:20px;
  background:black;
}

input{
  width:90%;
  padding:8px;
  margin:10px 0;
  border-radius:20px;
  border:1px solid #ccc;
  text-align:center;
}

button{
  padding:10px 20px;
  border:none;
  border-radius:25px;
  background:#ff5fa2;
  color:white;
  cursor:pointer;
  margin:5px;
}

#download{display:none}
canvas{display:none}
</style>
</head>

<body>

<h2>Couple Photobooth üíï</h2>

<div class="booth">
  <video id="video" autoplay playsinline></video>
  <input id="nameInput" placeholder="Nama Couple üíë">
  <button id="capture">üì∏ Ambil Foto</button>
  <button id="download">‚¨áÔ∏è Download Strip</button>
  <canvas id="canvas"></canvas>
</div>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const captureBtn = document.getElementById("capture");
const downloadBtn = document.getElementById("download");
const nameInput = document.getElementById("nameInput");

let photos = [];

/* ===== AKTIFKAN KAMERA BELAKANG ===== */
navigator.mediaDevices.getUserMedia({
  video:{ facingMode:{ ideal:"environment" } },
  audio:false
}).then(stream=>{
  video.srcObject = stream;
}).catch(err=>{
  alert("Kamera tidak bisa diakses");
});

/* ===== AMBIL FOTO ===== */
captureBtn.onclick = ()=>{
  if(photos.length >= 3) return;

  const temp = document.createElement("canvas");
  temp.width = video.videoWidth;
  temp.height = video.videoHeight;
  temp.getContext("2d").drawImage(video,0,0);
  photos.push(temp);

  if(photos.length === 3){
    createStrip();
    downloadBtn.style.display = "inline-block";
  }
};

/* ===== BACKGROUND GRID ===== */
function drawGrid(){
  ctx.fillStyle="#ffc1d9";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle="rgba(255,255,255,0.35)";
  ctx.lineWidth=2;

  for(let x=0;x<canvas.width;x+=40){
    ctx.beginPath();
    ctx.moveTo(x,0);
    ctx.lineTo(x,canvas.height);
    ctx.stroke();
  }

  for(let y=0;y<canvas.height;y+=40){
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(canvas.width,y);
    ctx.stroke();
  }
}

/* ===== FOTO TIDAK GEPENG ===== */
function drawPhotoCover(img,x,y,w,h){
  const ir = img.width/img.height;
  const fr = w/h;
  let sx,sy,sw,sh;

  if(ir > fr){
    sh = img.height;
    sw = sh * fr;
    sx = (img.width - sw)/2;
    sy = 0;
  }else{
    sw = img.width;
    sh = sw / fr;
    sx = 0;
    sy = (img.height - sh)/2;
  }

  ctx.drawImage(img,sx,sy,sw,sh,x,y,w,h);
}

/* ===== BINTANG ===== */
function drawStar(x,y,r){
  ctx.save();
  ctx.translate(x,y);
  ctx.beginPath();
  ctx.moveTo(0,-r);
  for(let i=0;i<5;i++){
    ctx.rotate(Math.PI/5);
    ctx.lineTo(0,-r*0.5);
    ctx.rotate(Math.PI/5);
    ctx.lineTo(0,-r);
  }
  ctx.closePath();
  ctx.fillStyle="white";
  ctx.fill();
  ctx.restore();
}

/* ===== PESAWAT KERTAS ===== */
function drawPaperPlane(x,y,size){
  ctx.fillStyle="white";
  ctx.beginPath();
  ctx.moveTo(x,y);
  ctx.lineTo(x+size,y+size/2);
  ctx.lineTo(x,y+size);
  ctx.lineTo(x+size*0.2,y+size/2);
  ctx.closePath();
  ctx.fill();
}

/* ===== STRIP FOTO ===== */
function createStrip(){
  const stripW = 900;
  const photoW = 520;
  const photoH = 700;
  const gap = 40;

  canvas.width = stripW;
  canvas.height = 160 + (photoH+gap)*3 + 200;

  drawGrid();

  ctx.font="54px Pacifico";
  ctx.fillStyle="#ff3d8b";
  ctx.textAlign="center";
  ctx.fillText("Couple üíï", stripW/2, 90);

  let y = 140;

  photos.forEach(p=>{
    const xPhoto = (stripW-photoW)/2;

    ctx.fillStyle="white";
    ctx.fillRect(xPhoto-15,y-15,photoW+30,photoH+30);

    drawPhotoCover(p,xPhoto,y,photoW,photoH);

    drawStar(xPhoto-40,y+100,10);
    drawStar(xPhoto+photoW+40,y+200,8);

    drawPaperPlane(xPhoto-70,y+photoH-120,30);
    drawPaperPlane(xPhoto+photoW+40,y+40,30);

    y += photoH + gap;
  });

  const name = nameInput.value || "Couple üíë";
  const date = new Date().toLocaleDateString("id-ID");

  ctx.font="42px Pacifico";
  ctx.fillStyle="#ff3d8b";
  ctx.fillText(name, stripW/2, canvas.height-90);

  ctx.font="24px Arial";
  ctx.fillText(date, stripW/2, canvas.height-50);
}

/* ===== DOWNLOAD ===== */
downloadBtn.onclick = ()=>{
  const a=document.createElement("a");
  a.download="photobooth-couple.png";
  a.href=canvas.toDataURL("image/png");
  a.click();
};
</script>

</body>
</html>
